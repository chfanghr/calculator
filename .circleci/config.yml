version: 2

jobs:
  build:
    docker:
      - image: "ubuntu:18.04"
    steps:
      - checkout
      - setup_remote_docker:
          docker_layer_caching: true
      - run: 'apt update && apt upgrade -y && apt install -y sudo'
      - run: 'apt install -y gcc g++ git cmake make wget pkg-config libreadline-dev libncurses-dev'
      - run: 'wget https://github.com/google/googletest/archive/release-1.10.0.tar.gz -O googletest.tar.gz'
      - run: 'tar -xf googletest.tar.gz'
      - run: 'cd googletest-release-1.10.0/ && cmake . && make && make install && ldconfig'
      - run: 'cc -v'
      - run: 'c++ -v'
      - run: 'cmake -H. -Bbuild'
      - run: 'cmake --build build'
      - run: 'build/examples/simple'
      - run: 'build/examples/version'
      - run: 'build/tests/calculator_tests'
      - run: 'printf "\n1+1\n6676767\ncos(pi)" > input && build/cmd/calc/calc < input && rm input'
      - run: 'build/cmd/calc/calc "1+1" "e*cos(pi)" "abs(-1)"'